<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Cat Zoomies - Automated Tests</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a2a;
            color: #00ff00;
            padding: 20px;
            margin: 0;
        }

        h1 {
            color: #ffdd00;
            text-align: center;
        }

        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: #0a0a15;
            padding: 20px;
            border: 2px solid #00ff00;
            border-radius: 8px;
        }

        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #12122a;
            border-left: 4px solid #00ff00;
        }

        .test-section.failed {
            border-left-color: #ff0000;
        }

        .test-section.running {
            border-left-color: #ffdd00;
        }

        .test-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .test-result {
            margin: 5px 0;
            padding: 5px;
        }

        .pass {
            color: #00ff00;
        }

        .fail {
            color: #ff0000;
        }

        .info {
            color: #aaaacc;
        }

        .summary {
            margin-top: 30px;
            padding: 20px;
            background: #2a2a4a;
            border-radius: 8px;
            text-align: center;
            font-size: 20px;
        }

        button {
            background: #4a4a8a;
            color: white;
            border: 2px solid #7a7aba;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            margin: 10px;
        }

        button:hover {
            background: #6a6aaa;
        }
    </style>
</head>

<body>
    <h1>ğŸ± Cat Zoomies - è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ</h1>

    <div class="test-container">
        <div style="text-align: center; margin-bottom: 20px;">
            <button onclick="runAllTests()">å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button onclick="clearResults()">çµæœã‚¯ãƒªã‚¢</button>
        </div>

        <div id="test-results"></div>

        <div id="summary" class="summary" style="display: none;"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.70.0/phaser.min.js"></script>
    <script src="js/sound.js"></script>
    <script src="js/textures.js"></script>
    <script src="js/effects.js"></script>
    <script src="js/mobile.js"></script>
    <script src="js/roguelite.js"></script>
    <script src="js/gathering.js"></script>
    <script src="js/stages.js"></script>
    <script src="js/validate.js"></script>

    <script>
        const W = 800, H = 550;
        let testResults = [];

        function log(testName, message, type = 'info') {
            const section = document.getElementById(`test-${testName.replace(/\s/g, '-')}`);
            if (section) {
                const result = document.createElement('div');
                result.className = `test-result ${type}`;
                result.textContent = `${type === 'pass' ? 'âœ“' : type === 'fail' ? 'âœ—' : 'â€¢'} ${message}`;
                section.appendChild(result);
            }
        }

        function createTestSection(testName) {
            const container = document.getElementById('test-results');
            const section = document.createElement('div');
            section.className = 'test-section running';
            section.id = `test-${testName.replace(/\s/g, '-')}`;

            const name = document.createElement('div');
            name.className = 'test-name';
            name.textContent = testName;
            section.appendChild(name);

            container.appendChild(section);
            return section;
        }

        function markTestComplete(testName, passed) {
            const section = document.getElementById(`test-${testName.replace(/\s/g, '-')}`);
            if (section) {
                section.className = `test-section ${passed ? '' : 'failed'}`;
            }
            testResults.push({ name: testName, passed });
        }

        // ãƒ†ã‚¹ãƒˆ1: è¨­å®šæ¤œè¨¼
        async function testConfigurationValidation() {
            const testName = 'è¨­å®šæ¤œè¨¼';
            createTestSection(testName);
            let passed = true;

            try {
                // STAGE_LAYOUTS ã¨ GATHERING_STAGE_LAYOUTS ã®åˆ†é›¢ç¢ºèª
                if (typeof STAGE_LAYOUTS !== 'undefined' && typeof GATHERING_STAGE_LAYOUTS !== 'undefined') {
                    log(testName, 'STAGE_LAYOUTS ã¨ GATHERING_STAGE_LAYOUTS ãŒæ­£ã—ãåˆ†é›¢ã•ã‚Œã¦ã„ã‚‹', 'pass');

                    // STAGE_LAYOUTS ã®ã‚­ãƒ¼ç¢ºèª
                    const stageKeys = Object.keys(STAGE_LAYOUTS);
                    if (stageKeys.length === 5) {
                        log(testName, `STAGE_LAYOUTS: ${stageKeys.length}ã‚¹ãƒ†ãƒ¼ã‚¸å®šç¾©`, 'pass');
                    } else {
                        log(testName, `STAGE_LAYOUTS: ${stageKeys.length}ã‚¹ãƒ†ãƒ¼ã‚¸ (æœŸå¾…å€¤: 5)`, 'fail');
                        passed = false;
                    }

                    // GATHERING_STAGE_LAYOUTS ã®ã‚­ãƒ¼ç¢ºèª
                    const gatheringKeys = Object.keys(GATHERING_STAGE_LAYOUTS);
                    if (gatheringKeys.length === 4) {
                        log(testName, `GATHERING_STAGE_LAYOUTS: ${gatheringKeys.length}ã‚¹ãƒ†ãƒ¼ã‚¸å®šç¾©`, 'pass');
                    } else {
                        log(testName, `GATHERING_STAGE_LAYOUTS: ${gatheringKeys.length}ã‚¹ãƒ†ãƒ¼ã‚¸ (æœŸå¾…å€¤: 4)`, 'fail');
                        passed = false;
                    }
                } else {
                    log(testName, 'ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®å®šç¾©ã«å•é¡Œã‚ã‚Š', 'fail');
                    passed = false;
                }

                // validateGameConfiguration ã‚’å®Ÿè¡Œ
                const originalConsoleLog = console.log;
                const originalConsoleError = console.error;
                const originalConsoleWarn = console.warn;

                let errorMessages = [];
                console.error = (...args) => { errorMessages.push(args.join(' ')); };
                console.warn = () => { };
                console.log = () => { };

                const isValid = validateGameConfiguration();

                console.log = originalConsoleLog;
                console.error = originalConsoleError;
                console.warn = originalConsoleWarn;

                if (isValid) {
                    log(testName, 'å…¨ä½“è¨­å®šæ¤œè¨¼ã«åˆæ ¼', 'pass');
                } else {
                    log(testName, `è¨­å®šæ¤œè¨¼ã«å¤±æ•—`, 'fail');
                    errorMessages.forEach(msg => log(testName, msg, 'fail'));
                    passed = false;
                }

            } catch (error) {
                log(testName, `ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
                passed = false;
            }

            markTestComplete(testName, passed);
        }

        // ãƒ†ã‚¹ãƒˆ2: ãƒ­ãƒ¼ã‚°ãƒ©ã‚¤ãƒˆã‚·ã‚¹ãƒ†ãƒ 
        async function testRogueliteSystem() {
            const testName = 'ãƒ­ãƒ¼ã‚°ãƒ©ã‚¤ãƒˆã‚·ã‚¹ãƒ†ãƒ ';
            createTestSection(testName);
            let passed = true;

            try {
                const manager = new PowerUpManager();
                log(testName, 'PowerUpManagerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ', 'pass');

                const added = manager.addPowerUp('catnip');
                if (added) {
                    log(testName, 'ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—è¿½åŠ æˆåŠŸ', 'pass');
                } else {
                    log(testName, 'ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—è¿½åŠ å¤±æ•—', 'fail');
                    passed = false;
                }

                const speedMult = manager.getMultiplier('speedMultiplier');
                if (speedMult === 1.5) {
                    log(testName, `é€Ÿåº¦å€ç‡æ­£å¸¸: ${speedMult}x`, 'pass');
                } else {
                    log(testName, `é€Ÿåº¦å€ç‡ç•°å¸¸: ${speedMult}x`, 'fail');
                    passed = false;
                }

                for (let i = 0; i < 6; i++) {
                    manager.addPowerUp('bell');
                }
                if (manager.activePowerUps.length === 5) {
                    log(testName, 'æœ€å¤§æ•°åˆ¶é™æ­£å¸¸: 5å€‹', 'pass');
                } else {
                    log(testName, `æœ€å¤§æ•°åˆ¶é™ç•°å¸¸: ${manager.activePowerUps.length}å€‹`, 'fail');
                    passed = false;
                }

                const progress = new StoryProgress();
                progress.completeStage(1000);
                if (progress.isGatheringUnlocked()) {
                    log(testName, 'çŒ«ã®é›†ä¼šè§£ç¦æ¡ä»¶æ­£å¸¸', 'pass');
                } else {
                    log(testName, 'çŒ«ã®é›†ä¼šè§£ç¦æ¡ä»¶ç•°å¸¸', 'fail');
                    passed = false;
                }

            } catch (error) {
                log(testName, `ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
                passed = false;
            }

            markTestComplete(testName, passed);
        }

        // ãƒ†ã‚¹ãƒˆ3: çŒ«ã®é›†ä¼šã‚·ã‚¹ãƒ†ãƒ 
        async function testGatheringSystem() {
            const testName = 'çŒ«ã®é›†ä¼šã‚·ã‚¹ãƒ†ãƒ ';
            createTestSection(testName);
            let passed = true;

            try {
                if (BOSS_CATS && BOSS_CATS.length === 4) {
                    log(testName, `ãƒœã‚¹çŒ«å®šç¾©æ­£å¸¸: ${BOSS_CATS.length}ä½“`, 'pass');
                } else {
                    log(testName, 'ãƒœã‚¹çŒ«å®šç¾©ç•°å¸¸', 'fail');
                    passed = false;
                }

                const layouts = ['kuro', 'shiro', 'mike', 'boss'];
                for (const id of layouts) {
                    if (GATHERING_STAGE_LAYOUTS[id]) {
                        const layout = GATHERING_STAGE_LAYOUTS[id];
                        log(testName, `${id}ã‚¹ãƒ†ãƒ¼ã‚¸: ${layout.items.length}ã‚¢ã‚¤ãƒ†ãƒ `, 'pass');
                    } else {
                        log(testName, `${id}ã‚¹ãƒ†ãƒ¼ã‚¸å®šç¾©ãªã—`, 'fail');
                        passed = false;
                    }
                }

                const rules = new TimeAttackRules('kuro');
                if (rules.targetTime === 45) {
                    log(testName, 'ã‚¯ãƒ­ã®ç›®æ¨™ã‚¿ã‚¤ãƒ æ­£å¸¸: 45ç§’', 'pass');
                } else {
                    log(testName, `ã‚¯ãƒ­ã®ç›®æ¨™ã‚¿ã‚¤ãƒ ç•°å¸¸: ${rules.targetTime}ç§’`, 'fail');
                    passed = false;
                }

                if (rules.checkWin(40) && !rules.checkWin(50)) {
                    log(testName, 'å‹æ•—åˆ¤å®šæ­£å¸¸', 'pass');
                } else {
                    log(testName, 'å‹æ•—åˆ¤å®šç•°å¸¸', 'fail');
                    passed = false;
                }

                const rankS = rules.getRank(30);
                const rankD = rules.getRank(52);
                if (rankS === 'S' && rankD === 'D') {
                    log(testName, 'ãƒ©ãƒ³ã‚¯ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸', 'pass');
                } else {
                    log(testName, `ãƒ©ãƒ³ã‚¯ã‚·ã‚¹ãƒ†ãƒ ç•°å¸¸: S=${rankS}, D=${rankD}`, 'fail');
                    passed = false;
                }

            } catch (error) {
                log(testName, `ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
                passed = false;
            }

            markTestComplete(testName, passed);
        }

        async function runAllTests() {
            clearResults();

            await testConfigurationValidation();
            await new Promise(resolve => setTimeout(resolve, 100));

            await testRogueliteSystem();
            await new Promise(resolve => setTimeout(resolve, 100));

            await testGatheringSystem();

            showSummary();
        }

        function showSummary() {
            const summary = document.getElementById('summary');
            const passed = testResults.filter(t => t.passed).length;
            const total = testResults.length;
            const percentage = Math.round((passed / total) * 100);

            summary.innerHTML = `
                <div style="font-size: 24px; margin-bottom: 10px;">
                    ${passed === total ? 'âœ“ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã«åˆæ ¼ã—ã¾ã—ãŸï¼' : 'âš  ä¸€éƒ¨ã®ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸ'}
                </div>
                <div>
                    åˆæ ¼: ${passed} / ${total} (${percentage}%)
                </div>
            `;
            summary.style.display = 'block';
            summary.style.background = passed === total ? '#2a4a2a' : '#4a2a2a';
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('summary').style.display = 'none';
            testResults = [];
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 500);
        });
    </script>
</body>

</html>